<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HANN 25 - ADMIN</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background: #050505; color: white; padding: 20px; }
        .card { background: #111; border: 1px solid #333; padding: 20px; border-radius: 15px; margin-bottom: 20px; max-width: 600px; margin-inline: auto; }
        h2 { color: #0ea5e9; font-size: 18px; border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 0; }
        label { display: block; font-size: 12px; color: #666; margin-bottom: 5px; margin-top: 10px; }
        input, select { width: 100%; padding: 12px; background: #000; border: 1px solid #333; border-radius: 8px; color: white; margin-bottom: 10px; box-sizing: border-box; outline: none; }
        .btn { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
        .btn-blue { background: #0ea5e9; color: white; }
        .btn-red { background: #ff4757; color: white; padding: 5px 10px; font-size: 11px; border-radius: 5px; }
        .item { display: flex; justify-content: space-between; align-items: center; background: #1a1a1a; padding: 12px; margin-bottom: 8px; border-radius: 8px; border: 1px solid #333; }
    </style>
</head>
<body id="admin-body" style="display:none;">
    <div class="card">
        <h2>ðŸ‘¤ PROFIL</h2>
        <input type="text" id="set-logo" placeholder="URL Logo">
        <input type="text" id="set-name" placeholder="Nama Brand">
        <button class="btn btn-blue" onclick="saveProfile()">Update Profil</button>
    </div>

    <div class="card">
        <h2>ðŸ“‚ KATEGORI</h2>
        <input type="text" id="cat-name" placeholder="Nama Kategori">
        <button class="btn btn-blue" onclick="addCategory()">Tambah</button>
        <div id="cat-list" style="margin-top:20px;"></div>
    </div>

    <div class="card">
        <h2>ðŸ”˜ TOMBOL</h2>
        <select id="select-cat"></select>
        <input type="text" id="btn-icon" placeholder="Emoji/Icon">
        <input type="text" id="btn-label" placeholder="Label">
        <input type="text" id="btn-link" placeholder="Link">
        <button class="btn btn-blue" onclick="addButton()">Simpan</button>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, onValue, push, remove, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const hashCheck = async (str, key) => {
        const enc = new TextEncoder();
        const cryptoKey = await crypto.subtle.importKey('raw', enc.encode(key), { name: 'HMAC', hash: 'SHA-256' }, false, ['sign']);
        const signature = await crypto.subtle.sign('HMAC', cryptoKey, enc.encode(str));
        return Array.from(new Uint8Array(signature)).map(b => b.toString(16).padStart(2, '0')).join('');
    };

    const init = async () => {
        const target = "77196020581335091726a84c680875e533088730999596486060609355428943";
        
        if (sessionStorage.getItem("__auth") !== "true") {
            const pw = prompt("PASSKEY:");
            if (!pw) return;
            
            const result = await hashCheck(pw, "170408");
            if (result === target) {
                sessionStorage.setItem("__auth", "true");
                document.getElementById("admin-body").style.display = "block";
            } else {
                document.body.innerHTML = "<div style='text-align:center;margin-top:100px;'><h1>ðŸ˜¡ðŸ–•</h1><p>LU MAU NGAPAIN TOLOL?</p><button onclick='location.reload()'>Coba Lagi</button></div>";
                document.body.style.display = "block";
                return;
            }
        } else {
            document.getElementById("admin-body").style.display = "block";
        }

        const conf = {
            apiKey: "AIzaSyBgqJ0f2v88T6Ijamd5gGS-NZzJyVl0pYU",
            authDomain: "adminhann25.firebaseapp.com",
            projectId: "adminhann25",
            databaseURL: "https://adminhann25-default-rtdb.asia-southeast1.firebasedatabase.app",
            storageBucket: "adminhann25.firebasestorage.app",
            messagingSenderId: "1020946488981",
            appId: "1:1020946488981:web:9b2cf0902f5665e342c59c"
        };

        const app = initializeApp(conf);
        const db = getDatabase(app);

        window.saveProfile = () => {
            const l = document.getElementById('set-logo').value, n = document.getElementById('set-name').value;
            if(l && n) set(ref(db, 'dashboard/profile'), { logo: l, name: n }).then(() => Swal.fire("Ok", "", "success"));
        };

        onValue(ref(db, 'dashboard/profile'), (s) => {
            if(s.exists()){
                document.getElementById('set-logo').value = s.val().logo;
                document.getElementById('set-name').value = s.val().name;
            }
        });

        window.addCategory = () => {
            const n = document.getElementById('cat-name').value.trim();
            if(n) push(ref(db, 'dashboard/categories'), { name: n.toUpperCase() }).then(() => { document.getElementById('cat-name').value = ""; });
        };

        onValue(ref(db, 'dashboard/categories'), (s) => {
            const l = document.getElementById('cat-list'), sc = document.getElementById('select-cat');
            l.innerHTML = ""; sc.innerHTML = "<option value=''>-- Pilih Kategori --</option>";
            if(s.exists()){
                s.forEach(c => {
                    l.innerHTML += `<div class="item"><span>${c.val().name}</span><button class="btn-red" onclick="del('dashboard/categories/${c.key}')">Hapus</button></div>`;
                    sc.innerHTML += `<option value="${c.key}">${c.val().name}</option>`;
                });
            }
        });

        window.addButton = () => {
            const id = document.getElementById('select-cat').value, i = document.getElementById('btn-icon').value, lb = document.getElementById('btn-label').value, ln = document.getElementById('btn-link').value;
            if(id && lb && ln) push(ref(db, `dashboard/categories/${id}/buttons`), { icon: i || 'ðŸ”—', label: lb, link: ln });
        };

        window.del = (p) => {
            Swal.fire({title: "Hapus?", showCancelButton: true}).then((r) => { if(r.isConfirmed) remove(ref(db, p)); });
        };
    };

    init();
</script>
</body>
</html>
